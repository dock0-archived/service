#!/command/execlineb -P

# Make sure everything is sane and ignore input
cd /
umask 022
fdclose 0

# This should be printed to the console
if { s6-echo "* init stage 1" }
# Close remaining handles to /dev/console
fdclose 1 fdclose 2

# Reopen stdin/stdout/stderr and make them point to the right places
redirfd -r 0 /dev/null
redirfd -wnb 1 /service/s6-svscan-log/fifo # (black magic: doesn't block)
fdmove -c 2 1

# Load the general environment
s6-envdir /etc/s6-init/env

# Start stage 2.
s6-svscan -t0 /service

